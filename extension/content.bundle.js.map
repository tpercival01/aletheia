{"version":3,"file":"content.bundle.js","mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://aletheia/./src/content/content.js"],"sourcesContent":["const payload = {\n  images: [],\n  texts: [],\n  videos: [],\n  audios: []\n}\n\nif (document.readyState === \"loading\"){\n  document.addEventListener(\"DOMContentLoaded\", scrapeInitial);\n} else {\n    scrapeInitial();\n}\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message.type === \"RESET_PAGE_CONTENT\") {\n    console.log(\"RESETTING\");\n    reset_everything();\n    sendResponse({ status: \"RESET_DONE\" });\n  } else if (message.type === \"SCAN_AGAIN\") {\n    console.log(\"SCANNING AGAIN\");\n    scrapeInitial();\n    sendResponse({ status: \"COMPLETED\" });\n  }\n});\n\n/* \n  IMAGES\n  Scrape and Clean\n  DONE\n*/\nfunction process_images(images) {\n  const seen = new Set();\n  for (let i = 0; i < images.length; i++) {\n    const image = images[i];\n    if (image.width > 30 && image.height > 30) {\n      if (image.src && !seen.has(image.src)) {\n        let xpath_ = generate_xpath(image);\n        seen.add(image.src)\n        let processed_image = {\n          alt: image.alt,\n          src: image.src,\n          xpath: xpath_,\n        };\n        payload.images.push(processed_image);\n      }\n    }\n  }\n}\n\n/* \n  TEXT\n  Scrape and Clean\n  DONE\n*/\nfunction process_text() {\n  const EXCLUDE_SELECTORS = [\n    'header', 'nav', 'footer', 'aside', 'script', 'style', 'noscript', 'button',\n    'meta', 'title', 'link', 'path',\n    '[role=banner]', '[role=navigation]', '[role=complementary]', \n    '[role=menubar]', '[role=menu]', '[aria-hidden=true]',\n    '.nav', '.navbar', '.menu', '.header', '.footer', '.sidebar', \n    '.cookie', '.popup', '.modal', '.ad', '.advertisement'\n  ].join(',');\n\n  const TEXT_BLACKLIST = [\n    'promoted', 'click here', 'read more', 'share', 'login', 'sign in', \n    'submit', 'privacy policy', 'user agreement', 'all rights reserved', \n    'learn more', 't&cs apply', 'terms and conditions'\n  ];\n\n  const elements = Array.from(document.querySelectorAll('*')).filter(el => {\n    if (el.matches(EXCLUDE_SELECTORS)) return false;\n    if (el.closest(EXCLUDE_SELECTORS)) return false;\n    return true;\n  });\n\n  const duplicate_set = new Set();\n  const indexMap = new Map();\n  payload.texts.length = 0;\n\n  elements.forEach(el => {\n    const text = (el.innerText || el.textContent || \"\").replace(/\\s+/g, ' ').trim();\n    if (!text) return;\n\n    const words = text.split(\" \");\n    if (words.length < 10) return;\n\n    if (TEXT_BLACKLIST.some(pattern => text.toLowerCase().includes(pattern))) return;\n\n    if (text === text.toUpperCase()) return;\n\n    const xpath = generate_xpath(el);\n    let shouldAdd = true;\n    const toRemove = [];\n    \n    for (let existing of duplicate_set){\n      if (xpath.startsWith(existing)){\n        toRemove.push(existing);\n      } else if (existing.startsWith(xpath)){\n        shouldAdd = false;\n        break;\n      }\n    }\n\n    toRemove.forEach(oldPath => {\n      duplicate_set.delete(oldPath);\n      const idx = indexMap.get(oldPath);\n      if (idx !== undefined){\n        payload.texts.splice(idx, 1);\n        indexMap.delete(oldPath);\n        for (let [p,i] of indexMap){\n          if (i > idx) indexMap.set(p, i - 1);\n        }\n      }\n    });\n\n    if (shouldAdd){\n      duplicate_set.add(xpath);\n      const newIndex = payload.texts.length;\n      payload.texts.push({text, xpath});\n      indexMap.set(xpath, newIndex);\n    }\n  });\n\n\n  console.log(payload.texts);\n}\n\n/* \n  VIDEO\n  Scrape and Clean\n  DONE\n*/\nfunction process_videos(videos) {}\n\n/* \n  AUDIO\n  Scrape and Clean\n  DONE\n*/\nfunction process_audio(audio) {}\n\nfunction generate_xpath(element) {\n  if (!element || element.nodeType !== Node.ELEMENT_NODE) {\n    return \"\";\n  }\n\n  const pathParts = [];\n  let currentNode = element;\n\n  while (currentNode && currentNode.nodeType === Node.ELEMENT_NODE) {\n    const tagName = currentNode.tagName.toLowerCase();\n    let segment = tagName;\n\n    const parent = currentNode.parentNode;\n    if (parent && parent.nodeType === Node.ELEMENT_NODE) {\n      const sameTagSiblings = Array.from(parent.children).filter(\n        (child) =>\n          child.nodeType === Node.ELEMENT_NODE &&\n          child.tagName.toLowerCase() === tagName\n      );\n\n      if (sameTagSiblings.length > 1) {\n        const index = sameTagSiblings.indexOf(currentNode) + 1;\n        segment += `[${index}]`;\n      }\n    }\n\n    pathParts.unshift(segment);\n\n    currentNode = parent;\n  }\n\n  return pathParts.length > 0 ? \"/\" + pathParts.join(\"/\") : \"\";\n}\n\n/*\n\nSCRAPE HTML ELEMENTS:\n\nTEXT: DONE\nIMAGES: NOT DONE\nVIDEO: NOT DONE\nAUDIO: NOT DONE\n\n*/\n\nfunction scrapeInitial() {\n  // IMAGES\n  //process_images(images);\n\n  // TEXT\n  process_text();\n\n  // VIDEO\n  // process_video(video);\n\n  // AUDIO\n  // process_audio(audio);\n\n  send_payload();\n}\n\nasync function send_payload() {\n  console.log(\"sent payload\");\n  try {\n    const response = await chrome.runtime.sendMessage({\n      type: \"PROCESS\",\n      payload: {\n        text: {\n          data: payload.texts,\n          source: \"content\",\n        },\n        images: {\n          data: payload.images,\n          source: \"content\",\n        },\n      },\n    });\n    console.log(\"received \", response);\n\n    const processed_payload = response;\n    console.log(processed_payload);\n    highlight_elements(processed_payload);\n\n  } catch (error) {\n    console.log(error);\n  }\n}\n\n/*\nHIGHLIGHTING ELEMENTS:\n\nText: DONE\nImages: NOT DONE\nVideo: NOT DONE\nAudio: NOT DONE\n\n*/\nfunction highlight_elements(payload) {\n  if (payload){\n    for (const item of payload){\n      // const el = document.evaluate(item.xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n      if (item.aiScore > 0.8){\n        el.style.setProperty(\"border\", \"5px solid red\", \"important\");\n      } else if (item.confidence > 0.5){\n        el.style.setProperty(\"border\", \"5px solid yellow\", \"important\");\n      }\n    }\n    \n  } else if (payload[\"images\"]){\n    console.log(\"images. no images.\")\n  //   for (const item of payload) {\n  //     let temp = document.evaluate(\n  //       item.xpath,\n  //       document,\n  //       null,\n  //       XPathResult.FIRST_ORDERED_NODE_TYPE,\n  //       null\n  //     ).singleNodeValue;\n  //     if (item.confidence > 0.8) {\n  //       temp.style.setProperty(\n  //         \"box-shadow\",\n  //         \"inset 0 0 10px #eb4034\",\n  //         \"important\"\n  //       );\n  //       temp.style.setProperty(\"border-radius\", \"1.25em\", \"important\");\n  //     } else if (item.confidence > 0.5) {\n  //       temp.style.setProperty(\"box-shadow\", \"2px solid #ffbf00\", \"important\");\n  //       temp.style.setProperty(\"border-radius\", \"1.25em\", \"important\");\n  //     } \n  //   }\n  }\n}\n\nfunction reset_everything() {\n\n // TEXT\n  for (const item of payloadTexts.data){\n    const el = document.evaluate(item.xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n    el.style.setProperty(\"border\", \"none\", \"important\");\n  }\n\n  // IMAGES\n\n  // VIDEOS\n\n  // AUDIO\n\n  // reset all payloads\n  payloadImages = [];\n  payloadTexts = [];\n  payloadIframes = [];\n  payloadVideos = [];\n}\n"],"names":[],"sourceRoot":""}